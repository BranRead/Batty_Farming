[gd_scene load_steps=14 format=2]

[ext_resource path="res://images/02_PixelSky_1920x1080.png" type="Texture" id=1]
[ext_resource path="res://LeftScreen.gd" type="Script" id=2]
[ext_resource path="res://RightScreen.gd" type="Script" id=3]
[ext_resource path="res://TopScreen.gd" type="Script" id=4]
[ext_resource path="res://BottomScreen.gd" type="Script" id=5]
[ext_resource path="res://Mouse.gd" type="Script" id=6]
[ext_resource path="res://images/batIcon.png" type="Texture" id=7]
[ext_resource path="res://MoneyLabel.gd" type="Script" id=8]

[sub_resource type="GDScript" id=1]
script/source = "extends Node
var food_packed_scene = preload(\"Food.tscn\")
var bat_packed_scene = preload(\"Bat.tscn\")
var rng = RandomNumberGenerator.new()
var guano_collected : int = 0
var is_mouse_touching_something : bool = false 
var money : float = 2.00
export var summon_buffer : int = 200

# Called when the node enters the scene tree for the first time.
func _ready():
	rng.randomize()
	
	for n in 2:
		var bat = bat_packed_scene.instance()
		var batDouble = bat.duplicate()
		batDouble.position = Vector2(rng.randi_range(summon_buffer, get_viewport().get_visible_rect().size.x - summon_buffer), rng.randi_range(summon_buffer, get_viewport().get_visible_rect().size.y - summon_buffer))
		add_child(batDouble)

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
	if Input.is_action_just_pressed(\"click\") && !is_mouse_touching_something:
		var mouse_position = get_viewport().get_mouse_position()
		var food = food_packed_scene.instance()
		if self.money > food.cost || is_equal_approx(self.money, food.cost):
			food.position = mouse_position
			self.money -= food.cost
			get_node(\"MoneyLabel\").update_money()
			food.add_to_group(\"food\", true)
			#print(get_tree().get_nodes_in_group(\"food\"))
			add_child(food)
		
	if Input.is_action_just_pressed(\"right_click\"):
		var mouse_position = get_viewport().get_mouse_position()
		var bat = bat_packed_scene.instance()
		#This is the most important part 
		#Otherwise the bats all share the same script
		var batDouble = bat.duplicate()
		batDouble.position = mouse_position
		add_child(batDouble)


func _on_Mouse_area_entered(area):
	#print(\"Can't drop food\")
	is_mouse_touching_something = true


func _on_Mouse_area_exited(area):
	#print(\"Can drop food\")
	is_mouse_touching_something = false


func _on_BatButton_pressed():
	var bat = bat_packed_scene.instance()
	if self.money > bat.cost || is_equal_approx(self.money, bat.cost):
			#This is the most important part 
			#Otherwise the bats all share the same script
			var batDouble = bat.duplicate()
			batDouble.position = Vector2(rng.randi_range(summon_buffer, get_viewport().get_visible_rect().size.x - summon_buffer), rng.randi_range(summon_buffer, get_viewport().get_visible_rect().size.y - summon_buffer))
			self.money -= bat.cost
			get_node(\"MoneyLabel\").update_money()
			add_child(batDouble)


func _on_BottomScreen_area_entered(area):
	if area.name_check == \"food\" || area.name_check == \"guano\":
		area.queue_free()
"

[sub_resource type="RectangleShape2D" id=2]
extents = Vector2( 41.5, 484.25 )

[sub_resource type="RectangleShape2D" id=3]
extents = Vector2( 883.75, 96.4375 )

[sub_resource type="CircleShape2D" id=4]

[sub_resource type="Theme" id=5]

[node name="Main" type="Node"]
script = SubResource( 1 )
summon_buffer = 301

[node name="CanvasLayer" type="CanvasLayer" parent="."]
layer = -1

[node name="Sprite" type="Sprite" parent="CanvasLayer"]
position = Vector2( 960, 530 )
scale = Vector2( 0.9, 0.9 )
z_index = -1
texture = ExtResource( 1 )

[node name="LeftScreen" type="Area2D" parent="CanvasLayer"]
script = ExtResource( 2 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/LeftScreen"]
position = Vector2( 51, 529 )
shape = SubResource( 2 )

[node name="RightScreen" type="Area2D" parent="CanvasLayer"]
script = ExtResource( 3 )

[node name="CollisionShape2D2" type="CollisionShape2D" parent="CanvasLayer/RightScreen"]
position = Vector2( 1866, 524 )
shape = SubResource( 2 )

[node name="TopScreen" type="Area2D" parent="CanvasLayer"]
position = Vector2( 694, -137 )
script = ExtResource( 4 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/TopScreen"]
position = Vector2( 272, 172.563 )
shape = SubResource( 3 )

[node name="BottomScreen" type="Area2D" parent="CanvasLayer"]
position = Vector2( 1388, -274 )
script = ExtResource( 5 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="CanvasLayer/BottomScreen"]
position = Vector2( -426, 1337 )
shape = SubResource( 3 )

[node name="Mouse" type="Area2D" parent="."]
script = ExtResource( 6 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="Mouse"]
scale = Vector2( 0.5, 0.5 )
shape = SubResource( 4 )

[node name="BatButton" type="Button" parent="."]
margin_left = 399.0
margin_top = -1.0
margin_right = 615.0
margin_bottom = 133.0
icon = ExtResource( 7 )
icon_align = 1

[node name="Label" type="Label" parent="BatButton"]
margin_top = 108.0
margin_right = 214.0
margin_bottom = 133.0
text = "Bat: $1.00"
align = 1

[node name="FoodUpgradeButton" type="Button" parent="."]
margin_left = 618.0
margin_top = 2.0
margin_right = 834.0
margin_bottom = 118.0
rect_pivot_offset = Vector2( 108, 163 )

[node name="FoodDropQuantityButton" type="Button" parent="."]
margin_left = 837.0
margin_top = 9.0
margin_right = 1053.0
margin_bottom = 125.0
rect_pivot_offset = Vector2( 108, 163 )

[node name="WaterGunUpgradeButton" type="Button" parent="."]
margin_left = 1069.0
margin_top = 5.0
margin_right = 1285.0
margin_bottom = 121.0
rect_pivot_offset = Vector2( 108, 163 )

[node name="FarmButton" type="Button" parent="."]
margin_left = 1305.0
margin_top = -5.0
margin_right = 1521.0
margin_bottom = 111.0
rect_pivot_offset = Vector2( 108, 163 )

[node name="MoneyLabel" type="Label" parent="."]
margin_left = 95.0
margin_top = 2.0
margin_right = 327.0
margin_bottom = 135.0
theme = SubResource( 5 )
text = "Money: $2.00"
align = 1
valign = 1
script = ExtResource( 8 )

[connection signal="area_entered" from="CanvasLayer/BottomScreen" to="." method="_on_BottomScreen_area_entered"]
[connection signal="area_entered" from="Mouse" to="." method="_on_Mouse_area_entered"]
[connection signal="area_exited" from="Mouse" to="." method="_on_Mouse_area_exited"]
[connection signal="pressed" from="BatButton" to="." method="_on_BatButton_pressed"]
